<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot GERAGRI</title>
    <style>
      :root {
        --primary-color: #2e7d32;
        --primary-dark: #1b5e20;
        --primary-light: #4caf50;
        --danger-color: #d32f2f;
        --danger-dark: #b71c1c;
        --gray-medium: #757575;
        --gray-dark: #616161;
        --border-radius: 8px;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
      }

      /* Contenedor principal del chatbot */
      .chatbot-container {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 380px;
        height: 520px;
        background-color: #fff;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 1000;
        transform: translateY(5px);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      .chatbot-container.visible {
        transform: translateY(0);
        opacity: 1;
      }

      /* Cabecera del chatbot */
      .chatbot-header {
        background-color: var(--primary-color);
        color: white;
        padding: 14px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .chatbot-title {
        font-weight: 600;
        font-size: 17px;
        letter-spacing: 0.3px;
      }

      .chatbot-controls {
        display: flex;
        gap: 12px;
      }

      .control-btn {
        background: none;
        border: none;
        color: white;
        font-size: 15px;
        cursor: pointer;
        padding: 3px 8px;
        border-radius: 4px;
        transition: background 0.2s;
      }

      .control-btn:hover {
        background-color: rgba(255, 255, 255, 0.25);
      }

      /* Cuerpo del chatbot */
      .chatbot-body {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      .chat-container {
        width: 100%;
        display: flex;
        flex-direction: column;
      }

      .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #fafafa;
        scroll-behavior: smooth;
      }

      /* Personalizaci√≥n de la barra de scroll */
      .chat-messages::-webkit-scrollbar {
        width: 6px;
      }

      .chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .chat-messages::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
      }

      .chat-messages::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }

      .message {
        margin-bottom: 8px;
        padding: 8px 12px;
        border-radius: var(--border-radius);
        max-width: 85%;
        font-size: 14px;
        line-height: 1.4;
        position: relative;
        animation: fadeIn 0.3s ease-out;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .bot-message {
        background-color: #edf7ed;
        align-self: flex-start;
        border-top-left-radius: 0;
      }

      .user-message {
        background-color: var(--primary-light);
        color: white;
        align-self: flex-end;
        border-top-right-radius: 0;
      }

      /* √Årea de entrada */
      .chat-input {
        display: flex;
        padding: 12px;
        border-top: 1px solid #e0e0e0;
        background-color: #f5f5f5;
      }

      .chat-input input {
        flex: 1;
        padding: 10px 14px;
        border: 1px solid #ddd;
        border-radius: 24px;
        outline: none;
        font-size: 14px;
        transition: border 0.3s;
      }

      .chat-input input:focus {
        border-color: var(--primary-color);
      }

      .chat-input button {
        margin-left: 12px;
        padding: 10px 16px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 24px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
      }

      .chat-input button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-1px);
      }

      .chat-input button:active {
        transform: translateY(0);
      }

      /* Bot√≥n de inicio */
      .chatbot-launcher {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 64px;
        height: 64px;
        background-color: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 999;
        transition: all 0.3s;
      }

      .chatbot-launcher:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
      }

      .chatbot-launcher i {
        font-size: 26px;
      }

      /* Estado minimizado */
      .chatbot-container.minimized {
        height: 46px;
        overflow: hidden;
      }

      /* Estado cerrado */
      .chatbot-container.closed {
        display: none;
      }

      /* Botones de opciones */
      .option-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 12px 0;
      }

      .option-btn {
        padding: 12px 16px;
        background-color: var(--primary-light);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .option-btn:hover {
        background-color: var(--primary-color);
        transform: translateX(2px);
      }

      .option-btn:active {
        transform: translateX(0);
      }

      .option-btn.has-children::after {
        content: "‚Ä∫";
        margin-left: 10px;
        font-size: 18px;
      }

      .back-btn {
        padding: 10px 14px;
        background-color: var(--gray-medium);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        text-align: left;
        cursor: pointer;
        font-size: 13px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        transition: all 0.2s;
      }

      .back-btn:hover {
        background-color: var(--gray-dark);
      }

      .back-btn::before {
        content: "‚Äπ";
        margin-right: 6px;
        font-size: 16px;
      }

      /* Im√°genes en las respuestas */
      .response-image-container {
        margin-top: 8px;
        text-align: center;
      }

      .response-image {
        max-width: 100%;
        max-height: 180px;
        border-radius: var(--border-radius);
        border: 1px solid #e0e0e0;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .response-image:hover {
        transform: scale(1.02);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* Bot√≥n de terminar conversaci√≥n */
      .end-chat-btn {
        padding: 10px;
        background-color: var(--danger-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        font-size: 14px;
        margin-top: 12px;
        width: 100%;
        transition: all 0.2s;
        font-weight: 500;
      }

      .end-chat-btn:hover {
        background-color: var(--danger-dark);
      }

      /* Bot√≥n de reiniciar conversaci√≥n */
      .restart-chat-btn {
        padding: 12px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        font-size: 14px;
        margin: 15px auto;
        display: block;
        width: 80%;
        transition: all 0.3s;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
        100% {
          transform: scale(1);
        }
      }

      .restart-chat-btn:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* Efecto de carga */
      .typing-indicator {
        display: inline-block;
        padding: 10px 14px;
        background-color: #edf7ed;
        border-radius: var(--border-radius);
        margin-bottom: 12px;
      }

      .typing-indicator span {
        height: 8px;
        width: 8px;
        background-color: #666;
        border-radius: 50%;
        display: inline-block;
        margin: 0 2px;
        animation: bounce 1.5s infinite ease-in-out;
      }

      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes bounce {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-5px);
        }
      }

      /* Modal para im√°genes */
      #imageModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        text-align: center;
      }

      #modalImage {
        max-height: 90%;
        max-width: 90%;
        margin-top: 5%;
      }

      #closeModal {
        position: absolute;
        top: 20px;
        right: 40px;
        color: white;
        font-size: 40px;
        cursor: pointer;
      }

      #openHD {
        display: block;
        color: white;
        margin-top: 10px;
        text-decoration: underline;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Bot√≥n para abrir el chatbot -->
    <div class="chatbot-launcher" id="launcher">
      <i class="fas fa-robot"></i>
    </div>

    <!-- Contenedor del chatbot -->
    <div class="chatbot-container" id="chatbot">
      <div class="chatbot-header" id="chatbotHeader">
        <div class="chatbot-title">Asistente GERAGRI</div>
        <div class="chatbot-controls">
          <button class="control-btn" id="minimizeBtn" title="Minimizar">
            <i class="fas fa-minus"></i>
          </button>
          <button class="control-btn" id="closeBtn" title="Cerrar">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="chatbot-body">
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <!-- Mensajes aparecer√°n aqu√≠ -->
          </div>

          <div class="chat-input">
            <input
              type="text"
              id="userInput"
              placeholder="Escribe tu mensaje..."
              autocomplete="off"
            />
            <button id="sendBtn" title="Enviar">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para im√°genes -->
    <div id="imageModal">
      <span id="closeModal">&times;</span>
      <img id="modalImage" />
      <a id="openHD" target="_blank">Abrir en HD</a>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const chatbot = document.getElementById("chatbot");
        const launcher = document.getElementById("launcher");
        const minimizeBtn = document.getElementById("minimizeBtn");
        const closeBtn = document.getElementById("closeBtn");
        const chatbotHeader = document.getElementById("chatbotHeader");
        const chatMessages = document.getElementById("chatMessages");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        const closeModal = document.getElementById("closeModal");
        const openHdLink = document.getElementById("openHD");

        let isMinimized = false;
        let isClosed = true;
        let currentMenu = null;
        let menuHistory = [];

        // Mostrar el chatbot con animaci√≥n al cargar
        setTimeout(() => {
          chatbot.classList.add("visible");
        }, 500);

        // Estructura de men√∫ (personalizable)
        // Estructura completa del men√∫ seg√∫n tu formato
        const menuStructure = {
          main: {
            title: "¬°Bienvenido a GERAGRI! ¬øEn qu√© puedo ayudarte?",
            options: [
              {
                text: "Servicio de Tramites",
                action: "menu",
                target: "STRAMITES",
              },
              {
                text: "Procedimientos Legales",
                action: "menu",
                target: "PLEGALES",
              },
              {
                text: "Procedimientos √Årea de comunidades campesinas, nativas y eriazos",
                action: "menu",
                target: "PAREA",
              },
              {
                text: "Terminar",
                action: "end",
                response: "Gracias por usar GERAGRI",
              },
            ],
          },
          STRAMITES: {
            title: "Tramites disponibles:",
            options: [
              {
                text: "Vacaciones Truncas y/o Compensaci√≥n Vacacional",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Solicitud dirigida al gerente\n‚Ä¢ Contratos, adendas o resoluciones de designaci√≥n y conclusi√≥n.\n‚Ä¢ Constancias de no deudor de la Unidad no Estructurada de Contabilidad, Tesorer√≠a y Control Patrimonial.",
              },
              {
                text: "Compensaci√≥n por Tiempo de Servicios",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Solicitud dirigida al gerente\n‚Ä¢ Resoluci√≥n de cese\n‚Ä¢ Constancia de pagos y descuentos\n‚Ä¢ Constancias de no deudor de la Unidad no Estructurada de Contabilidad, Tesorer√≠a y Control Patrimonial",
              },
              {
                text: "Gastos de sepelio y luto",
                action: "menu",
                target: "SEPELIO_LUTO",
              },
              {
                text: "Pensi√≥n por sobrevivencia",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Solicitud dirigida al gerente\n‚Ä¢ Acta de defunci√≥n\n‚Ä¢ Acta original de matrimonio\n‚Ä¢ DNI del fallecido\n‚Ä¢ DNI del solicitante\n‚Ä¢ Formato III - FORMATO DE SOLICITUD de la Resoluci√≥n Jefatural N¬∞ 150-2021-ONP-JF\n‚Ä¢ Resoluci√≥n de nombramiento\n‚Ä¢ Resoluci√≥n de incorporaci√≥n al D.L. N¬∞ 20530\n‚Ä¢ Resoluci√≥n de cese\n‚Ä¢ Resoluci√≥n de pensi√≥n definitiva\n‚Ä¢ 3 √∫ltimas boletas de pago de pensi√≥n del fallecido\n‚Ä¢ Nro de cuenta del Banco de la Naci√≥n.",
              },
              {
                text: "Reconocimiento como herederos de deuda social",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Sucesi√≥n intestada\n‚Ä¢ Testimonio expedido por la notar√≠a\n‚Ä¢ Sentencia de vista del proceso judicial\n‚Ä¢ Resoluci√≥n consentida del proceso judicial\n‚Ä¢ Liquidaci√≥n del proceso judicial\n‚Ä¢ DNI de los herederos universales",
              },
              { text: "Volver", action: "menu", target: "main" },
            ],
          },
          SEPELIO_LUTO: {
            title: "Tipo de Gastos:",
            options: [
              {
                text: "Subsidio por gastos por sepelio",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Solicitud dirigida al gerente\n‚Ä¢ Acta de defunci√≥n\n‚Ä¢ Acta original de matrimonio o de nacimiento, dependiendo de quien solicita.\n‚Ä¢ DNI del fallecido\n‚Ä¢ DNI del solicitante\n‚Ä¢ Comprobantes de pago de los gastos realizados\n‚Ä¢ Resoluci√≥n de pensi√≥n\n‚Ä¢ √öltima boleta de pago de pensi√≥n del fallecido\n‚Ä¢ Nro de cuenta del Banco de la Naci√≥n.",
              },
              {
                text: "Subsidio por fallecimiento",
                action: "message",
                response:
                  "Requisitos:\n‚Ä¢ Solicitud dirigida al gerente\n‚Ä¢ Acta de defunci√≥n\n‚Ä¢ Acta original de matrimonio o sucesi√≥n intestada, dependiendo de quien solicita.\n‚Ä¢ DNI del fallecido\n‚Ä¢ DNI del solicitante\n‚Ä¢ Resoluci√≥n de pensi√≥n\n‚Ä¢ √öltima boleta de pago de pensi√≥n del fallecido\n‚Ä¢ Nro de cuenta del Banco de la Naci√≥n.",
              },
              { text: "Volver", action: "menu", target: "STRAMITES" },
            ],
          },
          PLEGALES: {
            title: "Procedimientos disponibles:",
            options: [
              {
                text: "Sentencias consentidas",
                action: "message",
                response:
                  "Requisitos:\na) Copia del D.N.I del beneficiario (legible)\nb) Resoluci√≥n Directoral de Reconocimiento de Deuda\nc) Auto-admisorio de la Demanda\nd) Sentencia Judicial de 1ra y 2da Instancia\ne) Resoluci√≥n Judicial que declara Consentida\nf) Resoluci√≥n Judicial que aprueba la Liquidaci√≥n de Pool de Peritos\ng) Liquidaci√≥n de Pool de Peritos\nh) Resoluci√≥n Judicial de Requerimiento de Pago\ni) Notificaci√≥n Judicial de Requerimiento de Pago",
              },
              {
                text: "Requisito de herederos",
                action: "message",
                response:
                  "Requisitos:\na) Copia del D.N.I de herederos o beneficiarios\nb) Resoluci√≥n Directoral de Reconocimiento de Herederos\nc) Resoluci√≥n de Incorporaci√≥n al proceso judicial como heredero en el expediente principal en ejecuci√≥n\nd) Sucesi√≥n Intestada JUDICIAL O NOTARIAL\ne) Partida Registral de la Sucesi√≥n Intestada DEFINITIVA debidamente inscrita en la SUNARP",
              },
              {
                text: "Requisitos por enfermedad",
                action: "message",
                response:
                  "Requisitos:\na) Informe firma por la Junta de M√©dicos (TRES MEDICOS de MINSA O ESSALUD)\nb) Los m√©dicos que suscriben el informe deben estar habilitados, indicar especialidad y N.¬∞ de colegiatura otorgado por el Colegio de M√©dicos del Per√∫.\nc) Indicar FASE y/o ESTADO de la enfermedad sea terminal o avanzado de paciente\nd) Especificar EL CODIGO DE LA ENFERMEDAD\ne) Fecha, lugar, N.¬∞ de Informe, datos completos del paciente y motivo de la expedici√≥n del Informe",
              },
              { text: "Volver", action: "menu", target: "main" },
            ],
            note: "Estos documentos ser√°n presentados por MESA DE PARTES de sus Unidades o Gerencias donde est√° adscrito el beneficiario. En caso de regularizaci√≥n de documentos presentar en mesa de partes de la Procuradur√≠a Publica Regional de forma f√≠sica y en originales.",
          },
          PAREA: {
            title: "Procedimientos disponibles:",
            options: [
              {
                text: "Tramite Para Comunidades Campesinas",
                action: "menu",
                target: "CCAMPESINASS",
              },
              {
                text: "Tramite Para Comunidades Nativas",
                action: "menu",
                target: "CNATIVAS",
              },
              {
                text: "Procedimientos administrativos prestados",
                action: "menu",
                target: "PADMINISTRATIVOS",
              },
              {
                text: "Servicios catastrales prestados",
                action: "menu",
                target: "SCATASTRALES",
              },
              {
                text: "Formalizaci√≥n Tierras Eriazas",
                action: "message",
                response:
                  "Requisitos:\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO, en la cual se indique nombres y apellidos completos, domicilio y n√∫mero de DNI, y en su caso acreditar la calidad de apoderado o representante legal de la persona natural o jur√≠dica a quien representa, as√≠ como, fecha y firma.\nb. Copia simple del Documento Nacional de Identidad.\nc. Certificado de Inexistencia de Restos Arqueol√≥gicos (CIRA).\nd. ADJUNTAR LOS SIGUIENTES DOCUMENTOS:\n i). Para los predios ubicados en zonas no catastradas:\n - Plano perim√©trico a escala 1/500, 1/1000, 1/2500, 1/5000 o 1/10000 para terrenos hasta de 10 ha. o a escala 1/25000 para predios de mayor extensi√≥n, con su respectivo cuadro de datos t√©cnicos en coordenadas UTM georreferenciado al Sistema Geod√©sico Horizontal oficial del IGN, en Datum WGS 84, conteniendo el nombre de los colindantes y esquema de ubicaci√≥n respectivo.\n - Memoria descriptiva en donde deber√° de indicarse la descripci√≥n literal del plano, el n√∫mero de la partida registral de encontrarse el predio sobre un √°mbito inscrito y los datos del equipo o instrumento utilizado en el levantamiento del predio.\n - Data digital nativa y procesada del levantamiento de campo de acuerdo al instrumento utilizado (GPS, estaci√≥n total, otros), copia de la data digital y ficha de la estaci√≥n de rastreo permanente del IGN utilizada, de ser el caso y la Ficha Catastral Rural.\n - El plano, la memoria descriptiva y la ficha catastral rural deber√°n estar suscritos por Verificador Catastral del SNCP y se presentar√°n en formato f√≠sico y en formato digital (los planos en dwg y la memoria en Word o Pdf editable).\n ii). Si el predio se encuentra ubicado en zona catastrada:\n - El administrado solamente deber√° indicar el C√≥digo de Referencia Catastral (CRC) y dicha informaci√≥n catastral ser√° la referencia t√©cnica para continuar con el procedimiento, siempre y cuando dicha informaci√≥n tenga concordancia t√©cnica con la informaci√≥n f√≠sica del predio.\ne. Copia simple de la partida registral, plano perim√©trico y la memoria descriptiva del t√≠tulo archivado, solo en el caso que el predio se encuentre inscrito en una partida matriz del Estado, dicha copia se adjuntar√° solamente cuando el Ente de Formalizaci√≥n Regional no pueda acceder a los servicios de la Plataforma Inform√°tica - PIDE ya sea por inaccesibilidad al internet o carencia de recursos inform√°ticos.\nf. Una prueba principal que acrediten la posesi√≥n hasta el 31 de diciembre del 2015 y otros que permitan acreditar su habilitaci√≥n a dicha fecha, seg√∫n el art√≠culo 50 del reglamento.\ng. Una prueba complementaria como m√≠nimo que acredite la posesi√≥n hasta el 31 de diciembre del 2015 y otros que permitan acreditar su habilitaci√≥n a dicha fecha, seg√∫n el art√≠culo 50 del reglamento.\nh. Certificado de B√∫squeda Catastral (SUNARP).",
                image: "ERIAZAS.jpg",
              },
              {
                text: "Procedimientos de cambio de titular en zonas catastradas",
                action: "message",
                response:
                  "Requisitos:\na) La informaci√≥n se√±alada en el art√≠culo 124 del TUO de la LPAG;\nb) La ubicaci√≥n del predio y el C√≥digo de Referencia Catastral;\nc) Documento que acredite fehacientemente la condici√≥n de propietario. En caso de sucesivas transferencias, se acredita el tracto sucesivo;\nd) De encontrarse inscrito el predio, copia literal actualizada de la partida registral del predio.",
              },
              { text: "Volver", action: "menu", target: "main" },
            ],
          },
          CCAMPESINASS: {
            title: "Tipos de tramites:",
            options: [
              {
                text: "RECONOCIMIENTO COM. CAMPESINAS",
                action: "message",
                response:
                  "Requisitos: Para la inscripci√≥n de la Comunidad se requiere:\na. Constituir un grupo de m√°s de 50 familias.\nb. Tener la aprobaci√≥n de por lo menos los dos tercios de los integrantes de la Asamblea General.",
                image: "COM_CAMPESINAS-EVALUACION.png",
              },
              {
                text: "DESLINDE Y TITULACI√ìN DE COMUNIDADES CAMPESINAS",
                action: "message",
                response:
                  "Requisitos: El presidente de la Directiva Comunal, deber√° presentar los siguientes documentos:\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO, seg√∫n Formato del Anexo 03 de la RM N¬∞ 468-2016- MINAGRI.\nb. Copia simple del DNI del solicitante autorizado.\nc. Copia literal de la partida registral de la personer√≠a jur√≠dica de la Comunidad Campesina inscrita en los Registros P√∫blicos.",
                image: "DESLINDE_TITULACION_EVALUACION.png",
              },
              {
                text: "GEOREFERENCIACI√ìN COMUNIDADES CAMPESINAS",
                action: "message",
                response:
                  "Las Comunidades Campesinas, previamente a la presentaci√≥n de su solicitud de georreferenciaci√≥n de su territorio comunal titulado, deben contar con T√≠tulo de Propiedad, conformado por el Plano de Conjunto con o sin coordenadas UTM, Memoria Descriptiva y Actas de Colindancias, debidamente inscritos en la Oficina Registral de la Superintendencia Nacional de los Registros P√∫blicos (SUNARP), para lo cual deber√° formarse un expediente identificado con una car√°tula, (Anexo 01).\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO, firmada por el representante legal (de preferencia el presidente de la Directiva Comunal) o comuneros con facultades otorgados por la Asamblea General de la Comunidad Campesina, con vigencia de poder, adjuntando copia fedateada del Plano de Conjunto, Memoria Descriptiva y Actas de Colindancia, que se encuentren debidamente inscritos en la Oficina Registral de la Superintendencia Nacional de los Registros P√∫blicos (SUNARP). (Anexo N¬∞ 02).\nb. S√≠ los representantes legales de la Comunidad Campesina, son iletrados, deber√°n manifestar dicha situaci√≥n e imprimir su huella digital en la solicitud, en presencia del encargado de recibir la solicitud.\nc. Adjuntar el Acta de Asamblea General que otorga facultades para solicitar la georeferenciaci√≥n y suscribir Actas de Colindancia (Anexo N¬∞ 03).\nd. Los Planos de Conjunto inscritos deben carecer de coordenadas UTM, o que teniendo coordenadas no guarden relaci√≥n con la ubicaci√≥n real del territorio comunal o hubiera disconformidad entre el √°rea real y la que indican sus t√≠tulos o estos fueren imprecisos en cuanto a sus linderos, medidas perim√©tricas que comprende dicho territorio comunal.",
                image: "GEOREF_CAMPESI.png",
              },
              { text: "Volver", action: "menu", target: "PAREA" },
            ],
          },
          CNATIVAS: {
            title: "Tipos de tramites:",
            options: [
              {
                text: "RECONOCIMIENTO DE COM. NATIVAS",
                action: "message",
                response:
                  "El representante de la Comunidad Nativa encargado de gestionar el reconocimiento, deber√° presentar los siguientes documentos:\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO.\nb. Copia simple del Documento Nacional de Identidad (DNI) del solicitante, representante de la Comunidad Nativa.\nc. Copia del acta en que se acuerda solicitar el reconocimiento de la Comunidad Nativa y se elige a los representantes para lograr dichos fines.\nd. Relaci√≥n de los miembros de la Comunidad (Padr√≥n de la Comunidad).\ne. Croquis del territorio de la Comunidad Nativa, con la identificaci√≥n de zonas de viviendas, zonas de pesca, zonas de caza, recolecci√≥n u otros (Plano y Memoria Descriptiva).\nf. Copia de la credencial vigente del jefe de la Comunidad.\ng. Certificado de B√∫squeda Catastral (SUNARP).",
                image: "RECON_COM_NATIVA.png",
              },
              {
                text: "DEMARCACI√ìN Y TITULACI√ìN DE COMUNIDADES NATIVAS",
                action: "message",
                response:
                  "El jefe de la Comunidad y/o representante designado por Asamblea General deber√° presentar los siguientes documentos:\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO (Anexo 02)\nb. Copia simple del Acta de Asamblea General de la Comunidad Nativa designando a su representante, para iniciar y gestionar el procedimiento de demarcaci√≥n del territorio comunal (Anexo 03).\nc. Copia simple del DNI del solicitante.\nd. Copia literal de la partida registral de la personer√≠a jur√≠dica de la Comunidad Nativa inscrita en los Registros P√∫blicos\ne. Vigencia de poder del representante de Comunidad Nativa.\nf. Certificado de B√∫squeda Catastral emitido por la oficina de Registros P√∫blicos (SUNARP).",
                image: "DEMARC_COM_NATIVA.png",
              },
              {
                text: "GEOREFERENCIACI√ìN COMUNIDADES NATIVAS",
                action: "message",
                response:
                  "Las Comunidades Nativas, previamente a la presentaci√≥n de su solicitud de georeferenciaci√≥n del plano de demarcaci√≥n territorial, deben contar con T√≠tulo de Propiedad, plano de demarcaci√≥n territorial con o sin coordenadas UTM, y Memoria Descriptiva, debidamente inscritos en la Superintendencia Nacional de los Registros P√∫blicos - SUNARP.\na. Solicitud dirigida a la GERENCIA REGIONAL DE AGRICULTURA CUSCO, firmada por el representante legal (de preferencia el presidente o jefe de la Comunidad) o comuneros autorizados por la Asamblea General de la Comunidad Nativa, adjuntando copia del mismo y del Plano de demarcaci√≥n territorial y Memoria Descriptiva, que se encuentren debidamente inscritos en la Oficinas Reg√≠strales de la SUNARP, (Anexo 01).\nb. S√≠ los representantes legales de la Comunidad Nativa, son iletrados, deber√°n manifestar dicha situaci√≥n e imprimir su huella digital en la solicitud en presencia del encargado de recibir la solicitud.\nc. Los Planos de demarcaci√≥n territorial tituladas e inscritas deben carecer de coordenadas UTM, o teniendo coordenadas no guarden relaci√≥n con la ubicaci√≥n real del territorio comunal.",
                image: "GEOREF_NATIVA.png",
              },
              { text: "Volver", action: "menu", target: "PAREA" },
            ],
          },
          PADMINISTRATIVOS: {
            title: "Tipos de procedimientos:",
            options: [
              {
                text: "Saneamiento de predios r√∫sticos propiedad del estado (zonas catastradas/no catastradas)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "PAdm_1.png",
              },
              {
                text: "Saneamiento f√≠sico y formalizaci√≥n de tierras eriazas (antes 2010)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "PAdm_2.png",
              },
              {
                text: "Declaraci√≥n de propiedad por prescripci√≥n (predios particulares)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "PAdm_3.png",
              },
              {
                text: "Declaraci√≥n de propiedad y regularizaci√≥n de transferencias de dominio",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "PAdm_4.png",
              },
              {
                text: "Rectificaci√≥n de √°reas/linderos (predios rurales)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "PAdm_5.png",
              },
              { text: "Volver", action: "menu", target: "PAREA" },
            ],
          },
          SCATASTRALES: {
            title: "Tipos de servicios:",
            options: [
              {
                text: "Asignaci√≥n de C√≥digo catastral y expedici√≥n de certificado para inmatriculaci√≥n de predios (zonas no catastradas)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "SCat_1.png",
              },
              {
                text: "Asignaci√≥n de C√≥digo catastral y expedici√≥n de certificado para modificaci√≥n de predios (zonas catastradas)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "SCat_2.png",
              },
              {
                text: "Expedici√≥n de Certificado catastral para inmatriculaci√≥n de predios (zonas catastradas)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "SCat_3.png",
              },
              {
                text: "Visaci√≥n de planos y de memoria descriptiva de predios (procesos judiciales zonas catastradas/no catastradas)",
                action: "message",
                response: "REQUISITOS EN IMAGEN",
                image: "SCat_4.png",
              },
              { text: "Volver", action: "menu", target: "PAREA" },
            ],
          },
        };

        // Mostrar men√∫ inicial
        showMenu("main");

        // Funci√≥n para mostrar un men√∫
        function showMenu(menuId) {
          const menu = menuStructure[menuId];
          if (!menu) return;

          const typing = showTypingIndicator();

          setTimeout(() => {
            chatMessages.innerHTML = "";
            addBotMessage(menu.title);

            if (menuId !== "main") {
              const backDiv = document.createElement("div");
              const backBtn = document.createElement("button");
              backBtn.className = "back-btn";
              backBtn.textContent = "Volver";
              backBtn.onclick = function () {
                if (menuHistory.length > 0) {
                  const previousMenu = menuHistory.pop();
                  showMenu(previousMenu);
                }
              };
              backDiv.appendChild(backBtn);
              chatMessages.appendChild(backDiv);
            }

            const optionsDiv = document.createElement("div");
            optionsDiv.className = "option-buttons";

            menu.options.forEach((option) => {
              const btn = document.createElement("button");
              btn.className = "option-btn";
              if (option.action === "menu") btn.classList.add("has-children");
              btn.innerHTML = option.text;

              btn.onclick = function () {
                addUserMessage(
                  option.text.replace(/[^a-zA-Z√°-√∫√Å-√ö ]/g, "").trim()
                );

                if (option.action === "menu") {
                  if (menuId !== "main") menuHistory.push(menuId);
                  setTimeout(() => showMenu(option.target), 300);
                } else if (option.action === "message") {
                  setTimeout(() => {
                    if (option.image) {
                      addBotMessageWithImage(option.response, option.image);
                    } else {
                      addBotMessage(option.response);
                    }
                    setTimeout(() => showContinueOptions(menuId), 500);
                  }, 500);
                } else if (option.action === "end") {
                  endConversation(option.response);
                }
              };
              optionsDiv.appendChild(btn);
            });

            chatMessages.appendChild(optionsDiv);
            currentMenu = menuId;
          }, 800);
        }

        // Funci√≥n para mostrar mensaje con imagen
        function addBotMessageWithImage(text, imageUrl) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message bot-message";
          messageDiv.innerHTML = text.replace(/\n/g, "<br>");

          const imgContainer = document.createElement("div");
          imgContainer.className = "response-image-container";

          const img = document.createElement("img");
          img.src = imageUrl;
          img.className = "response-image";
          img.alt = "Imagen informativa";

          imgContainer.appendChild(img);
          messageDiv.appendChild(imgContainer);
          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        // Funci√≥n para mensajes del bot
        function addBotMessage(text) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message bot-message";
          messageDiv.innerHTML = text.replace(/\n/g, "<br>");
          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        // Funci√≥n para mensajes del usuario
        function addUserMessage(text) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message user-message";
          messageDiv.textContent = text;
          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        // Funci√≥n para terminar conversaci√≥n
        function endConversation(message) {
          chatMessages.innerHTML = "";
          addBotMessage(message);

          setTimeout(() => {
            const restartBtn = document.createElement("button");
            restartBtn.className = "restart-chat-btn";
            restartBtn.innerHTML =
              '<i class="fas fa-sync-alt"></i> Reiniciar chat';
            restartBtn.onclick = function () {
              menuHistory = [];
              showMenu("main");
            };
            chatMessages.appendChild(restartBtn);
            scrollToBottom();
          }, 2000);
        }

        // Funci√≥n para opciones de continuar
        function showContinueOptions(returnMenu) {
          const optionsDiv = document.createElement("div");
          optionsDiv.className = "option-buttons";

          const continueBtn = document.createElement("button");
          continueBtn.className = "option-btn";
          continueBtn.innerHTML =
            '<i class="fas fa-reply"></i> Continuar consulta';
          continueBtn.onclick = function () {
            showMenu(returnMenu);
          };
          optionsDiv.appendChild(continueBtn);

          const endBtn = document.createElement("button");
          endBtn.className = "end-chat-btn";
          endBtn.innerHTML =
            '<i class="fas fa-sign-out-alt"></i> Terminar chat';
          endBtn.onclick = function () {
            endConversation(
              "¬°Gracias por contactar a GERAGRI! üå±\nEstamos para servirte cuando lo necesites."
            );
          };
          optionsDiv.appendChild(endBtn);

          chatMessages.appendChild(optionsDiv);
          scrollToBottom();
        }

        // Funci√≥n para mostrar que el bot est√° escribiendo
        function showTypingIndicator() {
          const typingDiv = document.createElement("div");
          typingDiv.className = "typing-indicator";
          typingDiv.innerHTML = "<span></span><span></span><span></span>";
          chatMessages.appendChild(typingDiv);
          scrollToBottom();
          return typingDiv;
        }

        // Funci√≥n para scroll al final
        function scrollToBottom() {
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Evento para enviar mensaje
        function sendMessage() {
          const message = userInput.value.trim();
          if (message !== "") {
            addUserMessage(message);
            userInput.value = "";

            const typing = showTypingIndicator();

            setTimeout(() => {
              chatMessages.removeChild(typing);
              addBotMessage("Recib√≠ tu mensaje. ¬øQu√© m√°s necesitas?");

              const optionsDiv = document.createElement("div");
              optionsDiv.className = "option-buttons";

              const mainMenuBtn = document.createElement("button");
              mainMenuBtn.className = "option-btn";
              mainMenuBtn.innerHTML =
                '<i class="fas fa-home"></i> Men√∫ principal';
              mainMenuBtn.onclick = function () {
                menuHistory = [];
                showMenu("main");
              };
              optionsDiv.appendChild(mainMenuBtn);

              const endBtn = document.createElement("button");
              endBtn.className = "end-chat-btn";
              endBtn.innerHTML =
                '<i class="fas fa-sign-out-alt"></i> Terminar chat';
              endBtn.onclick = function () {
                endConversation(
                  "¬°Gracias por tu consulta! Si necesitas m√°s ayuda, reinicia el chat cuando quieras."
                );
              };
              optionsDiv.appendChild(endBtn);

              chatMessages.appendChild(optionsDiv);
              scrollToBottom();
            }, 1500);
          }
        }

        // Event listeners para im√°genes
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("response-image")) {
            modal.style.display = "block";
            modalImg.src = e.target.src;
            openHdLink.href = e.target.src;
          }
        });

        closeModal.addEventListener("click", function () {
          modal.style.display = "none";
        });

        modal.addEventListener("click", function (e) {
          if (e.target === modal) {
            modal.style.display = "none";
          }
        });

        // Event listeners del chatbot
        sendBtn.addEventListener("click", sendMessage);

        userInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            sendMessage();
          }
        });

        minimizeBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          isMinimized = !isMinimized;
          if (isMinimized) {
            chatbot.classList.add("minimized");
            minimizeBtn.innerHTML = '<i class="fas fa-plus"></i>';
          } else {
            chatbot.classList.remove("minimized");
            minimizeBtn.innerHTML = '<i class="fas fa-minus"></i>';
          }
        });

        closeBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          isClosed = true;
          chatbot.classList.remove("visible");
          setTimeout(() => {
            chatbot.classList.add("closed");
            launcher.style.display = "flex";
          }, 300);
        });

        launcher.addEventListener("click", function () {
          isClosed = false;
          chatbot.classList.remove("closed");
          setTimeout(() => {
            chatbot.classList.add("visible");
            launcher.style.display = "none";
          }, 50);
        });

        chatbotHeader.addEventListener("click", function () {
          if (isMinimized) {
            isMinimized = false;
            chatbot.classList.remove("minimized");
            minimizeBtn.innerHTML = '<i class="fas fa-minus"></i>';
          }
        });

        chatbot.addEventListener("click", function () {
          userInput.focus();
        });
      });
    </script>
  </body>
</html>
